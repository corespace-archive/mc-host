"use strict";const app=require("express")(),http=require("http").Server(app),io=require("socket.io")(http),tail=require("tail").Tail,fs=require("fs"),{exec}=require("child_process");let activeWatcher=!1;function executeCommand(e,t){exec(t,(e,t,r)=>{e?console.log(`error: ${e.message}`):r&&console.log(`stderr: ${r}`)})}fs.existsSync(__dirname+"/server")||fs.mkdir(__dirname+"/server",{recursive:!0},e=>{if(e)throw e}),fs.existsSync(__dirname+"/server/logs")||fs.mkdir(__dirname+"/server/logs",{recursive:!0},e=>{if(e)throw e;fs.writeFileSync(__dirname+"/server/logs/latest.log","")}),http.listen(3e3,()=>{console.log("Server running on: localhost:3000")}),app.get("/",(e,t)=>{t.sendFile(__dirname+"/assets/website/index.html")}),app.get("/console",(e,t)=>{t.sendFile(__dirname+"/assets/website/console.html")}),app.get("/styles",(e,t)=>{e=e.query.style;t.sendFile(__dirname+"/assets/website/assets/style/"+e+".css")}),app.get("/scripts",(e,t)=>{e=e.query.script;t.sendFile(__dirname+"/assets/website/assets/scripts/"+e+".js")}),io.on("connection",t=>{var e=new tail(__dirname+"/server/logs/latest.log");e.watch(),activeWatcher=!0,e.on("line",e=>{t.emit("joined",e)})}),io.on("connection",t=>{t.on("command",e=>{executeCommand(t,'docker exec -t mctest screen -S Minecraft-Server -p 0 -X stuff "'+e+'^M"'),t.emit("action_result",`Remote command executed: ${e}`)}),t.on("action",e=>{"start"==e&&(fs.existsSync(__dirname+"/server/plugins")?(executeCommand(t,"docker start mctest"),t.emit("action_result","Starting Server")):(executeCommand(t,"docker run -tid --name mctest --volume="+__dirname+"/server/:/server -p 25565:25565 -e RAM=4G zombymediaic/papermc:1.16.5-java16"),t.emit("action_result","Creating Server please wait..."))),"restart"==e&&(executeCommand(t,'docker exec -t mctest screen -S Minecraft-Server -p 0 -X stuff "save-all^M"'),executeCommand(t,'docker exec -t mctest screen -S Minecraft-Server -p 0 -X stuff "stop^M"'),setTimeout(()=>{executeCommand(t,"docker restart mctest"),t.emit("action_result","Restarting Server")},4e3)),"stop"==e&&(executeCommand(t,'docker exec -t mctest screen -S Minecraft-Server -p 0 -X stuff "save-all^M"'),executeCommand(t,'docker exec -t mctest screen -S Minecraft-Server -p 0 -X stuff "stop^M"'),t.emit("action_result","Stopping Server"))})});